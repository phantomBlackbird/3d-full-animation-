<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame D-Pad Game</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.2/dist/aframe-environment-component.min.js"></script>

    <style>
      /* D-Pad Overlay Styling */
      #controls {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 999;
        display: grid;
        grid-template-areas: 
          ". up ."
          "left . right"
          ". down .";
        gap: 10px;
        user-select: none;
      }
      .btn {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.3);
        border: 2px solid #fff;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        touch-action: none; /* Prevents scrolling while playing */
      }
      .btn:active { background: rgba(255, 255, 255, 0.6); }
      #up { grid-area: up; }
      #down { grid-area: down; }
      #left { grid-area: left; }
      #right { grid-area: right; }

      /* Action Pad Overlay (Right Side) */
#actions {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 999;
  display: grid;
  grid-template-areas: 
    ". jump ."
    "sneak . turn"
    ". crouch .";
  gap: 15px;
  user-select: none;
}

.action-btn {
  width: 70px;
  height: 70px;
  background: rgba(255, 165, 0, 0.4); /* Orange tint for actions */
  border: 2px solid #fff;
  border-radius: 50%; /* Circular buttons */
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 12px;
  font-weight: bold;
  text-align: center;
  touch-action: none;
}

.action-btn:active { background: rgba(255, 165, 0, 0.8); }

#jump { grid-area: jump; }
#sneak { grid-area: sneak; }
#turn { grid-area: turn; }
#crouch { grid-area: crouch; }

    </style>
  </head>

  <body>
    <div id="controls">
      <div id="up" class="btn">▲</div>
      <div id="left" class="btn">◀</div>
      <div id="right" class="btn">▶</div>
      <div id="down" class="btn">▼</div>
    </div>
<div id="actions">
  <div id="jump" class="action-btn">JUMP</div>
  <div id="sneak" class="action-btn">SNEAK</div>
  <div id="turn" class="action-btn">180</div>
  <div id="crouch" class="action-btn">CROUCH</div>
</div>

    <a-scene vr-mode-ui="enabled: false">
      <a-assets>
        <a-asset-item id="playerModel" src="character-model.glb"></a-asset-item>
      </a-assets>

      <a-entity environment="preset: forest; dressingAmount: 500;"></a-entity>

      <a-entity id="player" position="0 0 0">
        
        <a-entity id="character"
                  gltf-model="#playerModel"
                  scale="0.011 0.011 0.011" 
                  position="0 0 0" 
                  rotation="0 180 0"
                  animation-mixer="clip: Idle_Static; crossFadeDuration: 0.4">
        </a-entity>

        <a-entity id="camera-rig" position="0 1.2 3">
            <a-camera id="main-camera" look-controls="enabled: false" wasd-controls-enabled="false"></a-camera>
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
const player = document.querySelector('#player');
const character = document.querySelector('#character');
let speed = 0.1;
let moveDir = { x: 0, z: 0 };
let activeMove = false;

// 1. MOVEMENT DPAD LOGIC
const movementBtns = {
  up: { x: 0, z: -1, rot: 180 },
  down: { x: 0, z: 1, rot: 0 },
  left: { x: -1, z: 0, rot: -90 },
  right: { x: 1, z: 0, rot: 90 }
};

Object.keys(movementBtns).forEach(id => {
  const el = document.getElementById(id);
  el.addEventListener('touchstart', () => {
    speed = 0.1; // Default speed
    moveDir.x = movementBtns[id].x;
    moveDir.z = movementBtns[id].z;
    character.setAttribute('rotation', {y: movementBtns[id].rot});
    activeMove = true;
    character.setAttribute('animation-mixer', 'clip: Walk_Forward; crossFadeDuration: 0.4');
  });
  el.addEventListener('touchend', () => { 
    activeMove = false; 
    character.setAttribute('animation-mixer', 'clip: Idle_Static; crossFadeDuration: 0.4');
  });
});

// 2. ACTION PAD LOGIC
const actions = {
  jump: { clip: 'Jump_Up', loop: 'once' },
  turn: { clip: 'Turn_180', loop: 'once' },
  crouch: { clip: 'Crouch_Idle', loop: 'repeat' },
  sneak: { clip: 'Sneak_Walk_A', loop: 'repeat', speed: 0.04 }
};

Object.keys(actions).forEach(id => {
  const el = document.getElementById(id);
  
  el.addEventListener('touchstart', () => {
    const config = actions[id];
    
    // If it's the sneak button, enable movement at a slower speed
    if(id === 'sneak') {
      activeMove = true;
      speed = config.speed;
      moveDir = { x: 0, z: -1 }; // Always sneaks forward
      character.setAttribute('rotation', {y: 180});
    }
    
    character.setAttribute('animation-mixer', {
      clip: config.clip,
      loop: config.loop,
      crossFadeDuration: 0.3
    });
  });

  el.addEventListener('touchend', () => {
    activeMove = false;
    character.setAttribute('animation-mixer', 'clip: Idle_Static; crossFadeDuration: 0.4');
  });
});

// 3. GAME LOOP
function tick() {
  if (activeMove) {
    const pos = player.getAttribute('position');
    pos.x += moveDir.x * speed;
    pos.z += moveDir.z * speed;
    player.setAttribute('position', pos);
  }
  requestAnimationFrame(tick);
}
tick();

    </script>
  </body>
</html>
